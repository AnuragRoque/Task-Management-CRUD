<!DOCTYPE html>
<html>
<head>
    <title>Task Management</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
}

h1 {
    color: #333;
}

form {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 5px;
}

input[type="text"] {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
}

button {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
}

ul {
    list-style: none;
}

li {
    margin-bottom: 5px;
}

    </style>
</head>
<body>
    <h1>Task Management</h1>

    <h2>Add New Task </h2>
    <form id="addtaskForm">
        <label for="taskname">Task Name:</label>
        <input type="text" id="taskname" name="taskname" required>
        <br><br>
        <label for="taskpriority">Task Priority (1 - 10):</label>
        <input type="text" id="taskpriority" name="taskpriority" required>
        <br><br>
        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required>
        <br><br>
        <button type="submit">Add Task</button>
    </form>

    <h2>List of Tasks</h2>
    <ul id="taskList"></ul>

    <script>
        document.getElementById("addtaskForm").addEventListener("submit", function(event) {
            event.preventDefault();
    
            // Get form data
            const formData = new FormData(event.target);
            const taskname = formData.get("taskname");
            const taskpriority = formData.get("taskpriority");
            const date = formData.get("date");
    
            // Create a new employee object
            const newTask = {
                taskname: taskname,
                taskpriority: taskpriority,
                date: date
            };
    
            
            fetch('/api/taskmanage/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newTask)
            })
            .then(response => response.json())
            .then(data => {
                // If successful, reload the employee list
                if (data.id) {
                    fetchTaskList();
                    document.getElementById("addTaskForm").reset();
                }
            })
            .catch(error => console.error('Error:', error));
        });
    
        // Function to fetch and display the list of employees
        function fetchTaskList() {
            fetch('/api/taskmanage/')
            .then(response => response.json())
            .then(data => {
                const taskList = document.getElementById("taskList");
                taskList.innerHTML = "";
    
                data.forEach(task => {
                    const li = document.createElement("li");
                    li.textContent = `Priority:  ${task.taskpriority}, Task Name: ${task.taskname} , Date: ${task.date}`;
                    taskList.appendChild(li);
                });
            })
            .catch(error => console.error('Error:', error));
        }
    
        // Fetch and display the initial list of employees

        function createDeleteButton(taskId) {
            const deleteButton = document.createElement("button");
            deleteButton.textContent = "Delete Task";
            deleteButton.addEventListener("click", function() {
                deleteTask(taskId);
            });
            return deleteButton;
        }

        function deleteTask(taskId) {
            fetch(`/api/taskmanage/${taskId}/`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                // If successful, reload the task list
                fetchTaskList();
            })
            .catch(error => console.error('Error:', error));
        }

        function createTaskElement(task) {
            const li = document.createElement("li");
            li.textContent = `Priority:  ${task.taskpriority}, Task Name: ${task.taskname}, Date: ${task.date}`;
            const deleteButton = createDeleteButton(task.id);
            li.appendChild(deleteButton);
            return li;
        }

        fetchTaskList();
    </script>
    
</body>
</html>
